#멀티 쓰레드와 쓰레드 풀 

### 요청과 응답시 쓰레드 작동방식
1. 쓰레드는 휴식을 하고 있다가 요청이 들어오면 해당 요청에 쓰레드를 할당한다.
2. 쓰레드는 서블릿 객체를 호출한다.
3. 서블릿 객체는 요청에 맞는 응답을 반환한다. 
4. 모든 과정이 끝나면 쓰레드는 휴식상태로 들어간다. 

### 멀티 쓰레드 
* 쓰레드가 한개라면 단일 요청일 때는 문제가 없지만, 요청이 여러개 들어온다면 문제가 될 것이다.
* 다중 요청 들어온다면 먼저 들어온 요청을 한개의 쓰레드가 처리중이면 다른 요청은 해당 쓰레드를 사용하기 위해 대기할 수 밖에 없다. 
* 이런 문제를 해결하기 위해 새로운 요청이 들어올때마다 신규 쓰레드를 생성한다. 
* 하지만 매번 요청이 올 때마다 쓰레드를 생성하게 되면 장단점이있다.
    * 장점
        * 동시 요청을 처리할 수 있다.
        * 리소스(CPU, 메모리)가 허용할 때 까지 처리가 가능하다.
        * 하나의 쓰레드가 지연 되어도, 나머지 쓰레드는 정상 동작한다.
    * 단점
        * 쓰레드는 생성비용이 매우 비싸기 때문에 요청마다 쓰레드를 생성하면 응답 속도가 느려진다.
        * 쓰레드는 컨텍스트 스위칭 비용이 발생한다.
        * 쓰레드 생성에 제한이 없기 때문에 넘너무 많이 생성하면 CPU나 메모리 임계점을 넘어서 서버가 죽을 수 있다.
    * 이러한 단점을 해결하기 위한 것이 쓰레드 풀이다. 
* 멀티 쓰레드에 대한 부분은 WAS가 처리하기 때문에 개발자는 편리하게 소스 코드를 개발할 수 있다.
* 하지만 멀티 쓰레드 환경이므로 싱글톤 객체(서블릿, 스프링 빈)은 주의해서 사용해야한다. 


### 쓰레드 풀
* 쓰레드 풀은 필요한 쓰레드를 미리 만들어놓고 보관하고 관리한다.
* 쓰레드 풀에 생성 가능한 쓰레드의 최대치를 설정 할 수 있다.
    * 톰캣 - 최대 200개 기본 설정
* 쓰레드가 필요하면, 쓰레드 풀에서 꺼내서 사용하고 사용을 종료하면 쓰레드 풀에 쓰레드를 다시 반납한다.
* 만약 최대 쓰레드가 모두 사용중이어서 쓰레드 풀에 쓰레드가 없다면 기다리는 요청을 거절하거나 특정 숫자만큼만 대기하도록 설저아할 수 있다.
* 장점
    * 쓰레드가 미리 생성되어 있으므로, 쓰레드를 생성하고 종료하는 비용이 절약되고, 응답시간이 빠르다.
    * 생성 가능한 쓰레드의 최대치가 있으므로 너무 많은 요청이 들어와도 기존 요청은 안전하게 처리할 수 있다. 
* 성능 테스트를 통해 WAS의 최대 쓰레드 수를 최대한 적절하게 설정하는 것이 중요하다. 

> 참고
> * 인프런강의 - 스프링 MVC 1편 - 백엔드 웹 개발 핵심 기술를 듣고 작성한 글입니다.
> * [강의 링크] [link]

[link]: https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-mvc-1/dashboard
